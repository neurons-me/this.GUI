<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>this.GUI — Runtime</title>
<link rel="icon" href="https://res.cloudinary.com/dkwnxf6gm/image/upload/v1761276578/this.gui.npm.png" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/this.gui@latest/dist/this.gui.css" />
</head>
<body>
<div id="root"></div>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/react@18/umd/react-jsx-runtime.production.min.js"></script>
<script src="https://unpkg.com/react-router@6/umd/react-router.production.min.js"></script>
<script src="https://unpkg.com/react-router-dom@6/umd/react-router-dom.production.min.js"></script>
<script>
  // UMD externals shim: different bundlers expect different global names.
  // Ensure `react-router` / `react-router-dom` resolve for this.gui UMD.
  (function () {
    try {
      // Grab what the UMD builds provided.
      var RR = window.ReactRouter || window['react-router'] || null;
      var RRD = window.ReactRouterDOM || window.ReactRouterDom || window['react-router-dom'] || null;
      // Some UMD bundles wrap exports under `.default`.
      if (RR && RR.default && !RR.Routes) RR = RR.default;
      if (RRD && RRD.default && !RRD.Link) RRD = RRD.default;
      // If react-router-dom failed to load, create minimal shims so this.gui doesn't crash.
      if (!RRD || !RRD.Link) {
        var React = window.React;
        if (React) {
          var FallbackLink = React.forwardRef(function FallbackLink(props, ref) {
            var href = props && props.to ? props.to : props?.href || '#';
            return React.createElement(
              'a',
              {
                ref: ref,
                href: href,
                onClick: function (e) {
                  // allow middle-click/new tab, but replace current page otherwise
                  if (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey) return;
                  e.preventDefault();
                  if (href) window.location.assign(href);
                },
                style: props?.style,
                className: props?.className,
              },
              props?.children
            );
          });
          RRD = RRD || {};
          RRD.Link = RRD.Link || FallbackLink;
          RRD.useInRouterContext = RRD.useInRouterContext || function () { return false; };
          RRD.useHref = RRD.useHref || function (to) { return typeof to === 'string' ? to : '#'; };
        }
      }

      // Normalize canonical globals.
      if (RR && !window.ReactRouter) window.ReactRouter = RR;
      if (RRD && !window.ReactRouterDOM) window.ReactRouterDOM = RRD;
      // Alternate casing used by some externals configs.
      if (RRD && !window.ReactRouterDom) window.ReactRouterDom = RRD;
      // Package-name globals for certain externals configurations.
      if (RRD && !window['react-router-dom']) window['react-router-dom'] = RRD;
      if (RR && !window['react-router']) window['react-router'] = RR;

      // If useInRouterContext is missing (older build), polyfill a noop to prevent crashes.
      if (RRD && typeof RRD.useInRouterContext !== 'function') {
        RRD.useInRouterContext = function () {
          try {
            return typeof RR?.useInRouterContext === 'function' ? RR.useInRouterContext() : false;
          } catch (e) {
            return false;
          }
        };
      }
      if (RR && typeof RR.useInRouterContext !== 'function') {
        RR.useInRouterContext = function () { return false; };
      }
      // Last resort: if a bundle accidentally resolves `react-router-dom` to `react-router`,
      // prefer the DOM surface whenever it exists.
      if (window['react-router-dom'] && !window['react-router-dom'].Link && window.ReactRouterDOM?.Link) {
        window['react-router-dom'] = window.ReactRouterDOM;
      }
      if (window.ReactRouterDom && !window.ReactRouterDom.Link && window.ReactRouterDOM?.Link) {
        window.ReactRouterDom = window.ReactRouterDOM;
      }

      // Helpful debug when things still fail.
      // console.log('[shim] ReactRouterDOM keys:', RRD ? Object.keys(RRD) : null);
    } catch (e) {}
  })();
</script>
<script>
  window.process = {
    env: {
      NODE_ENV: "production"
    }
  };
</script>
<script src="https://cdn.jsdelivr.net/npm/this.gui@latest/dist/this.gui.umd.js"></script>
<script>
  (function () {
    const GUI = window.GUI;
    if (!GUI) {
      console.error('[GUI] window.GUI not found. UMD bundle may not be exposing correctly.');
      const rootEl = document.getElementById('root');
      if (rootEl) rootEl.innerHTML = '<div style="font-family:sans-serif;padding:24px;">❌ window.GUI not found</div>';
      return;
    }

    const rootEl = document.getElementById('root');
    if (!rootEl) {
      console.warn('[GUI] Root element not found.');
      return;
    }

    // Core exports (defensive lookups for UMD surface)
    const React = window.React;
    // Primitives (prefer root, then default)
    const GuiProvider = GUI.GuiProvider || GUI.default?.GuiProvider || null;
    const Layout = GUI.Layout || GUI.default?.Layout || null;
    const Atoms = GUI.atoms || GUI.Atoms || GUI.default?.atoms || GUI.default?.Atoms || {};
    const Box = GUI.Box || GUI.default?.Box || Atoms.Box || null;
    const Paper = GUI.Paper || GUI.default?.Paper || Atoms.Paper || null;
    const Typography = GUI.Typography || GUI.default?.Typography || Atoms.Typography || null;
    let TextField = GUI.TextField || GUI.default?.TextField || Atoms.TextField || null;
    const Stack = GUI.Stack || GUI.default?.Stack || Atoms.Stack || null;
    const Divider = GUI.Divider || GUI.default?.Divider || Atoms.Divider || null;
    const Button = GUI.Button || GUI.default?.Button || Atoms.Button || null;
    const IconButton = GUI.IconButton || GUI.default?.IconButton || Atoms.IconButton || null;
    const Tooltip = GUI.Tooltip || GUI.default?.Tooltip || Atoms.Tooltip || null;
    const Collapse = GUI.Collapse || GUI.default?.Collapse || Atoms.Collapse || null;
    const Link = GUI.Link || GUI.default?.Link || Atoms.Link || null;
    const Icon = GUI.Icon || GUI.default?.Icon || Atoms.Icon || null;
    const ThemeModeToggle = GUI.ThemeModeToggle || GUI.default?.ThemeModeToggle || null;
    // Ensure a Router exists for any internal Link usage.
    const ReactRouterDom = window.ReactRouterDOM;
    const BrowserRouter = ReactRouterDom?.BrowserRouter || null;

    // If TextField is missing on the UMD surface, create a minimal fallback so Explorer renders.
    if (!TextField && React) {
      const FallbackTextField = React.forwardRef(function FallbackTextField(props, ref) {
        const { label, helperText, error, fullWidth, ...rest } = props || {};
        return React.createElement(
          'div',
          { style: { display: 'flex', flexDirection: 'column', gap: 4, width: fullWidth ? '100%' : undefined } },
          label
            ? React.createElement('label', { style: { fontSize: 12, opacity: 0.9 } }, label)
            : null,
          React.createElement('input', {
            ref,
            ...rest,
            style: {
              padding: '10px 12px',
              borderRadius: 10,
              border: '1px solid rgba(255,255,255,0.18)',
              background: 'rgba(0,0,0,0.25)',
              color: 'inherit',
            },
          }),
          helperText
            ? React.createElement(
                'div',
                { style: { fontSize: 11, color: error ? '#ffb4ab' : 'rgba(255,255,255,0.7)' } },
                helperText
              )
            : null
        );
      });
      TextField = FallbackTextField;
    }

    // Left sidebar (static)
    const leftSidebarConfig = {
      initialView: 'rail',
      elements: [
        { type: 'link', props: { label: 'Home', icon: 'home', href: 'https://neurons-me.github.io/' } },
        { type: 'link', props: { label: 'all.this', icon: 'hub', href: 'https://neurons-me.github.io/all.this' } },
        { type: 'link', props: { label: '.GUI', icon: 'widgets', href: 'https://neurons-me.github.io/this.GUI' } },
        { type: 'link', props: { label: 'Themes', icon: 'palette', href: 'https://neurons-me.github.io/themes.html' } },
        { type: 'link', props: { label: 'Storybook', icon: 'auto_stories', href: 'https://neurons-me.github.io/storybook-static/' } },
        { type: 'link', props: { label: 'GitHub', icon: 'code', href: 'https://github.com/neurons-me/this.GUI' } },
        { type: 'link', props: { label: 'npm', icon: 'package_2', href: 'https://www.npmjs.com/package/this.gui' } },
      ],
    };

    function typeOfExport(v) {
      if (v == null) return 'null';
      if (Array.isArray(v)) return 'array';
      const t = typeof v;
      if (t === 'function') return 'function';
      if (t === 'object') {
        try {
          const $$ = v && v.$$typeof;
          const isReactElement = $$ && (String($$) === 'Symbol(react.element)' || $$ === Symbol.for('react.element'));
          if (isReactElement) return 'react.element';
          if ($$) return 'react.component';
        } catch (e) {}
        return 'object';
      }
      return t;
    }

    function safeKeys(obj) {
      try {
        return obj && typeof obj === 'object' ? Object.keys(obj).sort() : [];
      } catch (e) {
        return [];
      }
    }

    function flattenEntries(groupName, obj, prefix) {
      const keys = safeKeys(obj);
      return keys.map((k) => {
        const v = obj[k];
        return {
          group: groupName,
          key: k,
          path: prefix ? `${prefix}.${k}` : k,
          type: typeOfExport(v),
          value: v,
        };
      });
    }

    function Explorer() {
      // Hard requirement: render using this.GUI primitives only.
      // If any primitive is missing, show a small diagnostic in Typography.
      if (!Box || !Paper || !Typography || !TextField || !Stack) {
        const missing = [];
        if (!Box) missing.push('Box');
        if (!Paper) missing.push('Paper');
        if (!Typography) missing.push('Typography');
        if (!TextField) missing.push('TextField');
        if (!Stack) missing.push('Stack');

        return React.createElement(
          Box || 'div',
          { sx: { minHeight: '100vh', p: 3, bgcolor: 'background.default', color: 'text.primary' } },
          React.createElement(
            Paper || 'div',
            { sx: { p: 2, borderRadius: 3, border: '1px solid', borderColor: 'divider' } },
            React.createElement(Typography || 'div', { variant: 'h6' }, '.GUI — Explorer'),
            React.createElement(
              Typography || 'div',
              { variant: 'body2', sx: { mt: 1, color: 'text.secondary' } },
              '❌ Missing GUI primitives: ' + missing.join(', ') + '. (Check UMD surface / bundle exports.)'
            )
          )
        );
      }

      const [q, setQ] = React.useState('');
      const [open, setOpen] = React.useState({ root: true, atoms: true, molecules: true, components: true, widgets: true, menus: true });

      const rootEntries = React.useMemo(() => {
        const root = { ...GUI };
        // Avoid duplicating huge nested surfaces in the root list.
        delete root.atoms;
        delete root.molecules;
        delete root.widgets;
        delete root.menus;
        delete root.Atoms;
        delete root.Molecules;
        delete root.Components;
        delete root.Widgets;
        delete root.Menus;
        return flattenEntries('root', root, 'GUI');
      }, []);

      // Surfaces can be exported with different casing depending on the build.
      const ATOMS = GUI.atoms || GUI.Atoms || GUI.default?.atoms || GUI.default?.Atoms || {};
      const MOLECULES = GUI.molecules || GUI.Molecules || GUI.default?.molecules || GUI.default?.Molecules || {};
      const COMPONENTS = GUI.components || GUI.Components || GUI.default?.components || GUI.default?.Components || {};
      const WIDGETS = GUI.widgets || GUI.Widgets || GUI.default?.widgets || GUI.default?.Widgets || {};
      const MENUS = GUI.menus || GUI.Menus || GUI.default?.menus || GUI.default?.Menus || {};

      const atomsEntries = React.useMemo(() => flattenEntries('atoms', ATOMS, 'GUI.Atoms'), []);
      const moleculesEntries = React.useMemo(() => flattenEntries('molecules', MOLECULES, 'GUI.Molecules'), []);
      const componentsEntries = React.useMemo(() => flattenEntries('components', COMPONENTS, 'GUI.Components'), []);
      const widgetsEntries = React.useMemo(() => flattenEntries('widgets', WIDGETS, 'GUI.Widgets'), []);
      const menusEntries = React.useMemo(() => flattenEntries('menus', MENUS, 'GUI.Menus'), []);

      const all = React.useMemo(
        () => [...rootEntries, ...atomsEntries, ...moleculesEntries, ...componentsEntries, ...widgetsEntries, ...menusEntries],
        [rootEntries, atomsEntries, moleculesEntries, componentsEntries, widgetsEntries, menusEntries]
      );

      const filtered = React.useMemo(() => {
        const needle = String(q || '').trim().toLowerCase();
        if (!needle) return all;
        return all.filter((e) =>
          e.key.toLowerCase().includes(needle) ||
          e.path.toLowerCase().includes(needle) ||
          e.group.toLowerCase().includes(needle) ||
          e.type.toLowerCase().includes(needle)
        );
      }, [q, all]);

      const counts = React.useMemo(() => {
        const c = { root: 0, atoms: 0, molecules: 0, components: 0, widgets: 0, menus: 0 };
        for (const e of filtered) c[e.group] = (c[e.group] || 0) + 1;
        return c;
      }, [filtered]);

      function SectionHeader({ id, title, count }) {
        const toggle = () => setOpen((s) => ({ ...s, [id]: !s[id] }));
        const right = Stack
          ? React.createElement(
              Stack,
              { direction: 'row', spacing: 1, alignItems: 'center' },
              React.createElement(
                Typography,
                { variant: 'caption', sx: { px: 1, py: 0.35, borderRadius: 999, border: '1px solid', borderColor: 'divider', color: 'text.secondary' } },
                String(count)
              ),
              IconButton && Icon
                ? React.createElement(
                    IconButton,
                    { size: 'small', onClick: toggle, sx: { border: '1px solid', borderColor: 'divider' } },
                    React.createElement(Icon, { name: open[id] ? 'expand_less' : 'expand_more', fontSize: 18 })
                  )
                : null
            )
          : null;

        return React.createElement(
          Box,
          { sx: { display: 'flex', alignItems: 'center', justifyContent: 'space-between', cursor: 'pointer' }, onClick: toggle },
          React.createElement(Typography, { variant: 'subtitle1', sx: { fontWeight: 800, letterSpacing: -0.2 } }, title),
          right
        );
      }

      function GridFor(group) {
        const items = filtered.filter((e) => e.group === group);
        if (!items.length) {
          return React.createElement(Typography, { variant: 'body2', sx: { color: 'text.secondary', px: 0.5, py: 0.5 } }, '—');
        }
        return React.createElement(
          Box,
          {
            sx: {
              display: 'grid',
              gridTemplateColumns: 'repeat(auto-fit, minmax(220px, 1fr))',
              gap: 1,
              mt: 1,
            },
          },
          items.map((e) =>
            React.createElement(
              Paper,
              {
                key: e.path,
                variant: 'outlined',
                sx: { p: 1.25, borderRadius: 2, bgcolor: 'background.paper' },
              },
              React.createElement(
                Typography,
                {
                  variant: 'body2',
                  sx: {
                    fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',
                    wordBreak: 'break-word',
                  },
                },
                e.key
              ),
              React.createElement(
                Typography,
                { variant: 'caption', sx: { display: 'block', mt: 0.5, color: 'text.secondary' } },
                e.type + ' · ' + e.path
              )
            )
          )
        );
      }

      function Section({ id, title, count, group }) {
        const body = React.createElement(Box, { sx: { mt: 1 } }, GridFor(group));
        const content = Collapse
          ? React.createElement(Collapse, { in: !!open[id], timeout: 180 }, body)
          : open[id]
            ? body
            : null;

        return React.createElement(
          Paper,
          { variant: 'outlined', sx: { p: 1.5, borderRadius: 3 } },
          React.createElement(SectionHeader, { id, title, count }),
          content
        );
      }

      const header = React.createElement(
        Paper,
        { variant: 'outlined', sx: { p: 2, borderRadius: 3 } },
        React.createElement(Typography, { variant: 'h5', sx: { fontWeight: 900, letterSpacing: -0.4 } }, '.GUI — Explorer'),
        React.createElement(
          Typography,
          { variant: 'body2', sx: { mt: 0.75, color: 'text.secondary' } },
          'Inspect what is available on ',
          React.createElement(Typography, { component: 'span', sx: { fontFamily: 'ui-monospace, monospace', px: 0.75, py: 0.15, borderRadius: 1.5, border: '1px solid', borderColor: 'divider' } },
            'window.GUI'
          ),
          '. Use search to find components & surfaces.'
        ),
        React.createElement(
          Stack,
          { direction: 'row', spacing: 1, alignItems: 'center', sx: { mt: 2, flexWrap: 'wrap' } },
          React.createElement(TextField, {
            size: 'small',
            placeholder: 'Search exports (e.g. Button, Typography, menus, CodeBlock…)…',
            value: q,
            onChange: (e) => setQ(e.target.value),
            sx: { minWidth: 280, flex: '1 1 320px' },
          }),
          React.createElement(Typography, { variant: 'caption', sx: { px: 1, py: 0.6, borderRadius: 999, border: '1px solid', borderColor: 'divider', color: 'text.secondary' } }, 'root: ' + counts.root),
          React.createElement(Typography, { variant: 'caption', sx: { px: 1, py: 0.6, borderRadius: 999, border: '1px solid', borderColor: 'divider', color: 'text.secondary' } }, 'atoms: ' + counts.atoms),
          React.createElement(Typography, { variant: 'caption', sx: { px: 1, py: 0.6, borderRadius: 999, border: '1px solid', borderColor: 'divider', color: 'text.secondary' } }, 'molecules: ' + counts.molecules),
          React.createElement(Typography, { variant: 'caption', sx: { px: 1, py: 0.6, borderRadius: 999, border: '1px solid', borderColor: 'divider', color: 'text.secondary' } }, 'components: ' + counts.components),
          React.createElement(Typography, { variant: 'caption', sx: { px: 1, py: 0.6, borderRadius: 999, border: '1px solid', borderColor: 'divider', color: 'text.secondary' } }, 'widgets: ' + counts.widgets),
          React.createElement(Typography, { variant: 'caption', sx: { px: 1, py: 0.6, borderRadius: 999, border: '1px solid', borderColor: 'divider', color: 'text.secondary' } }, 'menus: ' + counts.menus)
        )
      );

      const sections = React.createElement(
        Stack,
        { spacing: 1.25, sx: { mt: 2 } },
        React.createElement(Section, { id: 'root', title: 'Root exports', count: counts.root, group: 'root' }),
        React.createElement(Section, { id: 'atoms', title: 'Atoms', count: counts.atoms, group: 'atoms' }),
        React.createElement(Section, { id: 'molecules', title: 'Molecules', count: counts.molecules, group: 'molecules' }),
        React.createElement(Section, { id: 'components', title: 'Components', count: counts.components, group: 'components' }),
        React.createElement(Section, { id: 'widgets', title: 'Widgets', count: counts.widgets, group: 'widgets' }),
        React.createElement(Section, { id: 'menus', title: 'Menus', count: counts.menus, group: 'menus' })
      );

      const footer = React.createElement(
        Box,
        { sx: { mt: 3, display: 'flex', justifyContent: 'center' } },
        Link
          ? React.createElement(
              Link,
              { href: 'https://neurons.me', target: '_blank', rel: 'noopener noreferrer', underline: 'none', sx: { opacity: 0.9 } },
              React.createElement(Typography, { variant: 'caption', sx: { color: 'text.secondary' } }, 'neurons.me')
            )
          : React.createElement(Typography, { variant: 'caption', sx: { color: 'text.secondary' } }, 'neurons.me')
      );

      return React.createElement(
        Box,
        { sx: { minHeight: '100vh', bgcolor: 'background.default', color: 'text.primary' } },
        React.createElement(
          Box,
          { sx: { px: { xs: 2, sm: 3 }, py: { xs: 2, sm: 3 }, maxWidth: 1100, mx: 'auto' } },
          header,
          sections,
          footer
        )
      );
    }

    const Page = window.React.createElement(Explorer, null);
    const WithRouter = BrowserRouter
      ? window.React.createElement(BrowserRouter, null, Page)
      : Page;
    const WithLayout = Layout
      ? window.React.createElement(
          Layout,
          {
            topBarConfig: {
              title: '.GUI',
              elementsRight: [
                {
                  type: 'action',
                  props: {
                    element: ThemeModeToggle
                      ? window.React.createElement(ThemeModeToggle, { variant: 'minimal', show: 'icons', iconSize: 'small' })
                      : null,
                  },
                },
              ],
            },
            leftSidebarConfig,
            rightSidebarConfig: false,
            footerConfig: false,
            children: WithRouter,
          }
        )
      : WithRouter;
    const App = GuiProvider
      ? window.React.createElement(GuiProvider, { theme: 'dark' }, WithLayout)
      : WithLayout;
    window.ReactDOM.createRoot(rootEl).render(App);
    try {
      console.log('[GUI.html] GUI keys:', Object.keys(GUI));
      console.log('[GUI.html] menus:', GUI.menus || GUI.Menus || GUI.default?.menus || GUI.default?.Menus || {});
    } catch (e) {}
  })();
</script>

</body>
</html>
